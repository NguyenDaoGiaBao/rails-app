<% content_for :styles do %>
    <%= stylesheet_link_tag "sweetalerts2" %>
    <%= stylesheet_link_tag "modal" %>
    <%= stylesheet_link_tag "tom-select.default.min" %>
    <%= stylesheet_link_tag "custom-tomSelect" %>
    <%= stylesheet_link_tag "custom-pagination" %>
<% end %>
<div id="tableCustomBasic" class="col-lg-12 col-12 layout-spacing">
  <%= form_with url: players_path, method: :get, local: true do %>
    <div class="row g-3 mb-3">
      <div class="col-sm-2">
        <%= text_field_tag :keyword, params[:keyword], placeholder: "Keyword...", class: "form-control form-control-sm" %>
      </div>
      <div class="col-sm">
        <%= button_tag "Search", type: "submit", name: nil, class: "btn btn-sm btn-primary" %>
      </div>
    </div>
  <% end %>
  <div class="statbox widget box box-shadow">
    <div class="widget-content widget-content-area">
      <div class="table-responsive">
        <table class="table table-bordered">
          <thead>
          <tr>
            <th scope="col">Player</th>
            <th class="text-center" scope="col">Email</th>
            <th class="text-center" scope="col">Point</th>
            <th class="text-center" scope="col"></th>
          </tr>
          </thead>
          <tbody>
          <% @players.each do |player| %>
            <%= render partial: "player", locals: { player: player } %>
          <% end %>
          </tbody>
          </table>
        <%= paginate @players, window: 2 %>
      </div>
    </div>
  </div>
  <!-- Modal -->

</div>
<% content_for :scripts do %>
  <%= javascript_include_tag "sweetalerts2.min" %>
  <%= javascript_include_tag "custom-sweetalert" %>
  <%= javascript_include_tag "tom-select.base" %>
  <%= javascript_include_tag "custom-tom-select" %>
<script>
    new TomSelect("#select-clubs", {
        create: true,
        sortField: {
            field: "text",
            direction: "asc"
        }
    });
    new TomSelect("#select-nationality", {
        create: true,
        sortField: {
            field: "text",
            direction: "asc"
        }
    });
    const Toast = Swal.mixin({
        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        timer: 3000,
        timerProgressBar: true,
        didOpen: (toast) => {
            toast.addEventListener('mouseenter', Swal.stopTimer)
            toast.addEventListener('mouseleave', Swal.resumeTimer)
        }
    })
    $(document).on('click', '.btn-delete', function () {
        let playerId = $(this).data('id');
        Swal.fire({
            title: 'Confirm delete',
            text: "Do you really want to delete this record?",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajaxSetup({
                    headers: {
                        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                    }
                });
                $.ajax({
                    url: '/players/' + playerId,
                    type: 'DELETE',
                    success: function () {
                        $('#row-front-' + playerId).remove();
                        Toast.fire({
                            icon: 'success',
                            title: 'Player was deleted successfully.'
                        })
                    },
                    error: function (xhr) {
                        console.log(xhr.responseText);
                        Swal.fire(
                            'Error!',
                            'Opps, has occurred error.',
                            'warning'
                        );
                    }
                });
            }
        })
    });

    // $(document).on('click', '.btn-view', function() {
    //     let myModal = new bootstrap.Modal(document.getElementById('myModal'), options)
    //     let playerId = $(this).data('id');
    //     console.log(playerId);
    // });

</script>
<% end %>
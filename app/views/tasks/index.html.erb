<% content_for :styles do %>
  <%= stylesheet_link_tag "todolist" %>
  <%= stylesheet_link_tag "quill.snow" %>
  <%= stylesheet_link_tag "sweetalerts2" %>
<% end %>

<div class="row layout-top-spacing">
  <div class="col-xl-12 col-lg-12 col-md-12">

    <div class="mail-box-container">
      <div class="mail-overlay"></div>

      <div class="tab-title">
        <div class="row">
          <div class="col-md-12 col-sm-12 col-12 text-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard">
              <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
              <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
            </svg>
            <h5 class="app-title">Todo List</h5>
          </div>
          <div class="col-md-12 col-sm-12 col-12 ps-0">
            <div class="todoList-sidebar-scroll mt-4">
              <ul class="nav nav-pills d-block" id="pills-tab" role="tablist">
                <li class="nav-item">
                  <a class="nav-link list-actions active" id="all-list" data-toggle="pill" href="#pills-inbox" role="tab" aria-selected="true">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-list">
                      <line x1="8" y1="6" x2="21" y2="6"></line>
                      <line x1="8" y1="12" x2="21" y2="12"></line>
                      <line x1="8" y1="18" x2="21" y2="18"></line>
                      <line x1="3" y1="6" x2="3" y2="6"></line>
                      <line x1="3" y1="12" x2="3" y2="12"></line>
                      <line x1="3" y1="18" x2="3" y2="18"></line>
                    </svg>
                    All <span class="todo-badge badge"></span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link list-actions" id="todo-task-done" data-toggle="pill" href="#pills-sentmail" role="tab" aria-selected="false">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-thumbs-up">
                      <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
                    </svg>
                    Done <span class="todo-badge badge"></span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link list-actions" id="todo-task-important" data-toggle="pill" href="#pills-important" role="tab" aria-selected="false">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star">
                      <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                    </svg>
                    Important <span class="todo-badge badge"></span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link list-actions" id="todo-task-trash" data-toggle="pill" href="#pills-trash" role="tab" aria-selected="false">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2">
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                      <line x1="10" y1="11" x2="10" y2="17"></line>
                      <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                    Trash</a>
                </li>
              </ul>
            </div>
          </div>
          <div class="col-md-12 col-sm-12 col-12">
            <a class="btn btn-secondary" href="/tasks/new">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
              New Task</a>
          </div>
        </div>
      </div>

      <div id="todo-inbox" class="accordion todo-inbox">
        <div class="search">
          <input type="text" class="form-control input-search" placeholder="Search Task...">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu mail-menu d-lg-none">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        </div>

        <div class="todo-box">

          <div id="ct" class="todo-box-scroll">
            <% @tasks.each do |task| %>
              <%= render partial: "task", locals: { task: task } %>
            <% end %>
          </div>

          <div class="modal fade" id="todoShowListItem" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="task-heading modal-title mb-0"></h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x">
                      <line x1="18" y1="6" x2="6" y2="18"></line>
                      <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                  </button>
                </div>
                <div class="modal-body">
                  <div class="compose-box">
                    <div class="compose-content">
                      <p class="task-text"></p>
                    </div>
                  </div>
                </div>
                <div class="modal-footer">
                  <button class="btn" data-bs-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

  </div>
</div>
<% content_for :scripts do %>
  <%= javascript_include_tag "todoList", "data-turbo-track": "reload" %>
  <%= javascript_include_tag "sweetalerts2.min" %>
  <%= javascript_include_tag "custom-sweetalert" %>
  <script>
      const Toast = Swal.mixin({
          toast: true,
          position: 'top-end',
          showConfirmButton: false,
          timer: 3000,
          timerProgressBar: true,
          didOpen: (toast) => {
              toast.addEventListener('mouseenter', Swal.stopTimer)
              toast.addEventListener('mouseleave', Swal.resumeTimer)
          }
      })

        $(document).on('click', '.task-delete', function () {
            let taskId = $(this).data('id');
            Swal.fire({
                title: 'Confirm delete',
                text: "Do you really want to delete this record?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajaxSetup({
                        headers: {
                            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                        }
                    });
                    $.ajax({
                        url: '/tasks/' + taskId,
                        type: 'DELETE',
                        success: function () {
                            $('#row-task-' + taskId).remove();
                            Toast.fire({
                                icon: 'success',
                                title: 'Task was deleted successfully.'
                            })
                        },
                        error: function (xhr) {
                            console.log(xhr.responseText);
                            Swal.fire(
                                'Error!',
                                'Opps, has occurred error.',
                                'warning'
                            );
                        }
                    });
                }
            })
        });

      $(document).on('click', '.is-done', function () {
          let taskId = $(this).data('id');
          $.ajaxSetup({
              headers: {
                  'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
              }
          });
          $.ajax({
              url: '/tasks/' + taskId + '/done',
              type: 'PUT',
              success: function () {
                  $('#row-task-' + taskId).toggleClass('todo-task-done');
              },
              error: function (xhr) {
                  console.log(xhr.responseText);
                  Swal.fire(
                      'Error!',
                      'Opps, has occurred error.',
                      'warning'
                  );
              }
          });
      });

  </script>
<% end %>
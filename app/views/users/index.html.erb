<% content_for :styles do %>
	<%= stylesheet_link_tag "sweetalerts2" %>
	<%= stylesheet_link_tag "modal" %>
<% end %>
<div id="tableCustomBasic" class="col-lg-12 col-12 layout-spacing">
	<div class="statbox widget box box-shadow">
		<div class="widget-content widget-content-area">
			
			<div class="table-responsive">
				<table class="table table-bordered">
					<thead>
					<tr>
						<th scope="col">Name</th>
						<th class="text-center" scope="col">Role</th>
						<th class="text-center" scope="col">Status</th>
						<th class="text-center" scope="col"></th>
					</tr>
					</thead>
					<tbody>
					<% @users.each do |user| %>
						<tr id="row-user-<%= user.id %>">
							<td>
								<div class="media">
									<div class="media-body align-self-center">
										<h6 class="mb-0"><%= user.name %></h6>
										<span class="text-danger"><%= user.email_address %></span>
									</div>
								</div>
							</td>
							<td class="text-center">
								<span class="text-<%= role_display(user.role_before_type_cast)[:css_class] %>">
									<%= role_display(user.role_before_type_cast)[:name] %>
								</span>
							</td>
							<td class="text-center">
								<span class="badge <%= user.active ? 'badge-light-success' : 'badge-light-dark' %>">
									<%= user.active ? "Active" : "Deactivate" %>
								</span>
							</td>
							<td class="text-center">
								<div class="action-btns">
									<a href="/users/<%= user.id %>" class="action-btn btn-edit bs-tooltip me-2" data-toggle="tooltip" data-placement="top" title="Edit">
										<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2">
											<path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
										</svg>
									</a>
									<% if policy(User).destroy? %>
										<%#= link_to user_path(user), method: :delete, data: { confirm: "Bạn có chắc chắn muốn xoá?" }, class: "btn btn-sm btn-danger delete-user-btn" do %>
<!--											<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2">-->
<!--												<polyline points="3 6 5 6 21 6"></polyline>-->
<!--												<path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>-->
<!--												<line x1="10" y1="11" x2="10" y2="17"></line>-->
<!--												<line x1="14" y1="11" x2="14" y2="17"></line>-->
<!--											</svg>-->
<!--											Delete-->
										<%# end %>
										<%= button_to "Xoá", user_path(user), method: :delete, data: { turbo_confirm: "Are you sure?" }, class: "btn btn-danger" %>
								<% end %>
								</div>
							</td>
						</tr>
						</tbody>
						
					<% end %>
					</table>
			</div>
		</div>
	</div>
	<!-- Modal -->

</div>
<% content_for :scripts do %>
	<%= javascript_include_tag "custom-sweetalert" %>
	<script>
        const Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true,
            didOpen: (toast) => {
                toast.addEventListener('mouseenter', Swal.stopTimer)
                toast.addEventListener('mouseleave', Swal.resumeTimer)
            }
        })
        $(document).on('click', '.btn-delete', function () {
            let playerId = $(this).data('id');
            Swal.fire({
                title: 'Confirm delete',
                text: "Do you really want to delete this record?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajaxSetup({
                        headers: {
                            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                        }
                    });
                    $.ajax({
                        url: '/players/' + playerId,
                        type: 'DELETE',
                        success: function () {
                            $('#row-front-' + playerId).remove();
                            Toast.fire({
                                icon: 'success',
                                title: 'Player was deleted successfully.'
                            })
                        },
                        error: function (xhr) {
                            console.log(xhr.responseText);
                            Swal.fire(
                                'Error!',
                                'Opps, has occurred error.',
                                'warning'
                            );
                        }
                    });
                }
            })
        });

        // $(document).on('click', '.btn-view', function() {
        //     let myModal = new bootstrap.Modal(document.getElementById('myModal'), options)
        //     let playerId = $(this).data('id');
        //     console.log(playerId);
        // });
        //
	</script>
<% end %>
<% content_for :styles do %>
  <%= stylesheet_link_tag "filepond.min" %>
  <%= stylesheet_link_tag "FilePondPluginImagePreview.min" %>
  <%= stylesheet_link_tag "tabs" %>
  <%= stylesheet_link_tag "alert" %>
  <%= stylesheet_link_tag "switches" %>
  <%= stylesheet_link_tag "account-setting" %>
<% end %>

<div class="account-settings-container layout-top-spacing">
  <div class="account-content">
    <div class="tab-content" id="animateLineContent-4">
      <div class="tab-pane fade active show" id="animated-underline-home" role="tabpanel" aria-labelledby="animated-underline-home-tab">
        <% if flash[:alert] %>
          <div class="alert alert-arrow-right alert-icon-right alert-light-warning alert-dismissible fade show mb-4" role="alert">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-alert-circle">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12" y2="16"></line>
            </svg>
            <strong>Warning!</strong>  <%= flash[:alert] %>
          </div>
        <% end %>
        <% if flash[:notice] %>
          <div class="alert alert-arrow-right alert-icon-right alert-light-success alert-dismissible fade show mb-4 text-center" role="alert">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-alert-circle">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12" y2="16"></line>
            </svg>
            <strong>Success!</strong>  <%= flash[:notice] %>
          </div>
        <% end %>
        <div class="row">
          <div class="col-xl-12 col-lg-12 col-md-12 layout-spacing">
            <%= form_with model: @user, url: update_profile_path(@user), method: :patch, class: "section general-info", local: true do |form| %>
              <div class="info">
                <h6 class="">General Information</h6>
                <div class="row">
                  <div class="col-lg-11 mx-auto">
                    <div class="row">
                      <div class="col-xl-2 col-lg-12 col-md-4">
                        <div class="profile-image  mt-4 pe-md-4">

                          <!-- // The classic file input element we'll enhance
                          // to a file pond, we moved the configuration
                          // properties to JavaScript -->

                          <div class="img-uploader-content">
                            <!--                            <input type="file" class="filepond"-->
                            <!--                                   name="filepond" accept="image/png, image/jpeg, image/gif"/>-->
                            <%= form.file_field :avatar, class: "filepond", accept: "image/png, image/jpeg, image/gif", id: "avatar" %>
                          </div>

                        </div>
                      </div>
                      <div class="col-xl-10 col-lg-12 col-md-8 mt-md-0 mt-4">

                        <div class="form">
                          <div class="row">
                            <div class="col-md-6">
                              <div class="form-group">
                                <%= form.label :name, "Name <span class='text-danger'>*</span>".html_safe %>
                                <%= form.text_field :name, class: "form-control #{'is-invalid' if @user.errors[:name].any?} mb-3", placeholder: "Name" %>
                                <% if @user.errors[:name].any? %>
                                  <span class="text-danger">
                                    <%= @user.errors[:name].first %>
                                  </span>
                                <% end %>
                              </div>
                            </div>

                            <div class="col-md-6">
                              <div class="form-group">
                                <%= form.label :user_name, "User name <span class='text-danger'>*</span>".html_safe %>
                                <%= form.text_field :user_name, class: "form-control #{'is-invalid' if @user.errors[:user_name].any?} mb-3", placeholder: "User name" %>
                                <% if @user.errors[:user_name].any? %>
                                  <span class="text-danger">
                                    <%= @user.errors[:user_name].first %>
                                  </span>
                                <% end %>
                              </div>
                            </div>

                            <div class="col-md-6 mb-3">
                              <div class="form-group">
                                <%= form.label :email, "Email <span class='text-danger'>*</span>".html_safe %>
                                <%= form.text_field :email_address, class: "form-control #{'is-invalid' if @user.errors[:email_address].any?}", placeholder: "Email" %>
                                <% if @user.errors[:email_address].any? %>
                                  <span class="text-danger">
                                    <%= @user.errors[:email_address].first %>
                                  </span>
                                <% end %>
                              </div>
                            </div>

                            <div class="col-md-6">
                              <div class="form-group">
                                <%= form.label :role, "Role<span class='text-danger'>*</span>".html_safe %>
                                <%= form.select :role, User.roles.keys.map { |p| [p, p] }, { prompt: "Select role" }, { class: "form-control #{'is-invalid' if @user.errors[:role].any?}" } %>
                                <% if @user.errors[:role].any? %>
                                  <span class="text-danger">
                                    <%= @user.errors[:role].first %>
                                  </span>
                                <% end %>
                              </div>
                            </div>

                            <div class="col-md-6">
                              <div class="form-group">
                                <%= form.label :address, "Address".html_safe %>
                                <%= form.text_field :address, class: "form-control #{'is-invalid' if @user.errors[:address].any?} mb-3", placeholder: "Address" %>
                                <% if @user.errors[:address].any? %>
                                  <span class="text-danger">
                                    <%= @user.errors[:address].first %>
                                  </span>
                                <% end %>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="form-group">
                                <%= form.label :website, "Website".html_safe %>
                                <%= form.text_field :website, class: "form-control #{'is-invalid' if @user.errors[:website].any?} mb-3", placeholder: "Website" %>
                                <% if @user.errors[:website].any? %>
                                  <span class="text-danger">
                                    <%= @user.errors[:website].first %>
                                  </span>
                                <% end %>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="form-group">
                                <%= form.label :phone, "Phone".html_safe %>
                                <%= form.text_field :phone, class: "form-control #{'is-invalid' if @user.errors[:phone].any?} mb-3", placeholder: "Phone" %>
                                <% if @user.errors[:phone].any? %>
                                  <span class="text-danger">
                                    <%= @user.errors[:phone].first %>
                                  </span>
                                <% end %>
                              </div>
                            </div>
                            <div class="col-md-12 mt-1">
                              <div class="form-group text-end">
                                <%= form.submit "Save", class: "btn btn-secondary" %>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<% content_for :scripts do %>
  <%= javascript_include_tag "filepond.min" %>
  <%= javascript_include_tag "FilePondPluginFileValidateType.min", "data-turbo-track": "reload" %>
  <%= javascript_include_tag "FilePondPluginImageExifOrientation.min", "data-turbo-track": "reload" %>
  <%= javascript_include_tag "FilePondPluginImagePreview.min", "data-turbo-track": "reload" %>
  <%= javascript_include_tag "FilePondPluginImageCrop.min", "data-turbo-track": "reload" %>
  <%= javascript_include_tag "FilePondPluginImageResize.min", "data-turbo-track": "reload" %>
  <%= javascript_include_tag "FilePondPluginImageTransform.min", "data-turbo-track": "reload" %>
  <%= javascript_include_tag "filepondPluginFileValidateSize.min", "data-turbo-track": "reload" %>
  <%= javascript_include_tag "custom-filepond", "data-turbo-track": "reload" %>
  <%= javascript_include_tag "account-settings", "data-turbo-track": "reload" %>
  <script>
      /**
       * ==================
       * Single File Upload
       * ==================
       */

      // We register the plugins required to do
      // image previews, cropping, resizing, etc.
      FilePond.registerPlugin(
          FilePondPluginFileValidateType,
          FilePondPluginImageExifOrientation,
          FilePondPluginImagePreview,
          FilePondPluginImageCrop,
          FilePondPluginImageResize,
          FilePondPluginImageTransform,
//   FilePondPluginImageEdit
      );

      // Select the file input and use
      // create() to turn it into a pond
      FilePond.create(
          document.querySelector('#avatar'),
          {
              server: {
                  process: '/players',
                  revert: '/revert',
                  restore: null,
                  load: null,
                  fetch: null,
              },
              imagePreviewHeight: 170,
              imageCropAspectRatio: '1:1',
              imageResizeTargetWidth: 200,
              imageResizeTargetHeight: 200,
              stylePanelLayout: 'compact circle',
              styleLoadIndicatorPosition: 'center bottom',
              styleProgressIndicatorPosition: 'right bottom',
              styleButtonRemoveItemPosition: 'left bottom',
              styleButtonProcessItemPosition: 'right bottom',
              files: [
                  {
                      // the server file reference
                      source: '',

                      // set type to limbo to tell FilePond this is a temp file
                      options: {
                          type: 'image/png',
                      },
                  },
              ],
          }
      );
  </script>
<% end %>